(function(e){function t(t){for(var n,o,r=t[0],l=t[1],c=t[2],d=0,f=[];d<r.length;d++)o=r[d],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(f.length)f.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var e,t=0;t<s.length;t++){for(var a=s[t],n=!0,r=1;r<a.length;r++){var l=a[r];0!==i[l]&&(n=!1)}n&&(s.splice(t--,1),e=o(o.s=a[0]))}return e}var n={},i={app:0},s=[];function o(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=n,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;s.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var n=a("85ec"),i=a.n(n);i.a},"1fde":function(e,t,a){"use strict";var n=a("4244"),i=a.n(n);i.a},"36b2":function(e,t,a){"use strict";var n=a("f0f1"),i=a.n(n);i.a},4244:function(e,t,a){},5677:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("div",{attrs:{id:"nav"}},[a("router-link",{attrs:{to:"/katex"}},[e._v("wysiwygMath - KaTeX")])],1),a("div",{staticStyle:{padding:"40px"}},[a("keep-alive",[a("router-view")],1)],1)])},s=[],o={created:function(){"/katex"!==this.$router.currentRoute.path&&this.$router.push("/katex")}},r=o,l=(a("034f"),a("2877")),c=Object(l["a"])(r,i,s,!1,null,null,null),u=c.exports,d=a("8c4f"),f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wysimath-app"},[e._m(0),a("transition",{attrs:{name:"fade"}},[a("span",{staticClass:"popup",class:{hidden:!e.showPopup},on:{mousedown:e.preventHide}},[a("span",{staticClass:"border-right"},e._l(e.fontStyles,(function(t,n){return a("button",{key:n,staticClass:"popup-button",class:{selected:t.selected},on:{click:function(a){return e.setStyle(t.style,!1,null,!0)}}},[a("i",{class:t.icon})])})),0),a("span",{staticClass:"border-right"},[a("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedFontSize,expression:"selectedFontSize"}],on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedFontSize=t.target.multiple?a:a[0]},e.changeFontSize]}},e._l(e.newFontSizes,(function(t){return a("option",{key:t},[e._v(e._s(t))])})),0)]),a("span",{staticClass:"border-right"},e._l(e.textStyles,(function(t,n){return a("button",{key:n,staticClass:"popup-button",class:{selected:t.selected},on:{click:function(a){e.textAlign(t.style),t.selected=!t.selected}}},[a("i",{class:t.icon})])})),0),a("span",{staticClass:"border-right"},e._l(e.lists,(function(t,n){return a("button",{key:n,staticClass:"popup-button",class:{selected:t.selected},on:{click:function(a){return e.setStyle(t.style,!1,null)}}},[a("i",{class:t.icon})])})),0),a("span",{staticClass:"border-right"},[e.enableImageUpload?a("button",{staticClass:"popup-button",on:{click:e.insertImage}},[a("i",{staticClass:"fas fa-image"})]):e._e(),a("button",{staticClass:"popup-button",on:{click:e.createFormula}},[a("i",{staticClass:"fas fa-square-root-alt"})])]),a("span",{},[a("button",{staticClass:"popup-button",on:{click:function(t){return e.setStyle("undo")}}},[a("i",{staticClass:"fas fa-undo-alt"})])])])]),a("span",{ref:"textarea",staticClass:"form-control editor",style:e.noHeight?"":"height: calc(1.5em * "+e.rows+" + .75rem + 2px);",attrs:{id:e.id,placeholder:e.placeholder,contenteditable:""},on:{focusin:function(t){e.showPopup=!0},focusout:e.hideSelf,input:e.onDivInput,change:e.onDivInput,keyup:e.updateCursorPos}}),a("div",[e._v(" dataRaw "),a("div",[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.data,expression:"data"}],attrs:{cols:"100",rows:"10"},domProps:{value:e.data},on:{input:[function(t){t.target.composing||(e.data=t.target.value)},e.onDataRawInput],change:e.onDataRawInput}})])]),a("formula-modal",{ref:"formulaAddModal",on:{"insert-latex":e.insertLaTeX}}),a("formula-modal",{ref:"formulaEditModal",attrs:{"is-in-edit-mode":""},on:{"insert-latex":e.modifyLaTeX}}),a("image-modal",{ref:"imageAddModal",on:{"insert-images":e.insertImages}})],1)},h=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d-flex justify-content-end"},[a("h3",[e._v("KaTeX")])])}],m=(a("7db0"),a("4160"),a("a630"),a("caad"),a("c975"),a("d81d"),a("fb6a"),a("b0c0"),a("a9e3"),a("d3b7"),a("25f0"),a("2532"),a("3ca3"),a("159b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],ref:"formula",staticClass:"wysiwyg-math-formula",attrs:{contenteditable:"false","data-latex":e.latex},on:{dblclick:e.edit}})}),p=[],v={name:"mathFormula",props:{latex:String},data:function(){return{show:!1}},methods:{edit:function(){window.bus.$emit("formula-click",{element:this.$refs.formula,latex:this.latex})},render:function(){var e=this;this.show=!1,setTimeout((function(){window.katex.render("".concat(e.latex),e.$refs.formula,{throwOnError:!1,output:"html"}),e.$refs.formula.innerHTML=" "+e.$refs.formula.innerHTML+" ",e.show=!0}),100)}},mounted:function(){this.render()}},g=v,b=(a("fc20"),Object(l["a"])(g,m,p,!1,null,null,null)),w=b.exports,y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showModal,expression:"showModal"}],staticClass:"modal-mask"},[a("div",{staticClass:"modal-wrapper"},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title"},[e._v(e._s(e.isInEditMode?"Редактировать формулу":"Вставить формулу"))]),a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"},on:{click:function(t){e.showModal=!1}}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])]),a("div",{staticClass:"modal-body"},[a("div",{ref:"patterns",staticClass:"d-flex mb-3"},[a("div",{staticClass:"d-flex"},[a("div",{staticStyle:{position:"relative"}},[a("div",{staticClass:"py-1 px-2 text-center section-button",class:{expanded:e.showLetters},attrs:{tabindex:"0"},on:{click:function(t){e.showLetters=!e.showLetters},focusout:e.hideSelf}},[e._v(" \\(\\alpha \\beta \\delta\\) ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showLetters,expression:"showLetters"}],staticStyle:{"z-index":"100","background-color":"#ffffff",position:"absolute",top:"100%",left:"0","margin-top":"8px",border:"black 1px solid","border-radius":"4px",padding:"4px",display:"grid","grid-template-columns":"repeat(8, 1fr)","flex-wrap":"wrap","text-align":"center"},on:{mousedown:e.preventHide}},e._l(e.letters,(function(t,n){return a("div",{key:n,staticClass:"letter",on:{click:function(a){return e.insertLetter(t)}}},[e._v(" \\( "+e._s(t)+" \\) ")])})),0)]),a("div",{staticClass:"ml-2",staticStyle:{position:"relative"}},[a("div",{staticClass:"py-1 px-2 text-center section-button",class:{expanded:e.showOperators},attrs:{tabindex:"0"},on:{click:function(t){e.showOperators=!e.showOperators},focusout:e.hideSelf}},[e._v(" \\(\\sum\\) ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showOperators,expression:"showOperators"}],staticStyle:{"z-index":"100","background-color":"#ffffff",position:"absolute",top:"100%",left:"0","margin-top":"8px",border:"black 1px solid","border-radius":"4px",padding:"4px",display:"grid","grid-template-columns":"repeat(4, 1fr)","flex-wrap":"wrap","text-align":"center"},on:{mousedown:e.preventHide}},e._l(e.operators,(function(t,n){return a("div",{key:n,staticClass:"letter",on:{click:function(a){return e.insertOperator(t)}}},[e._v(" \\("+e._s(t)+"\\) ")])})),0)]),a("div",{staticClass:"ml-2",staticStyle:{position:"relative"}},[a("div",{staticClass:"py-1 px-2 text-center section-button",class:{expanded:e.showSymbols},attrs:{tabindex:"0"},on:{click:function(t){e.showSymbols=!e.showSymbols},focusout:e.hideSelf}},[e._v(" \\(\\neq\\) ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showSymbols,expression:"showSymbols"}],staticStyle:{"z-index":"100","background-color":"#ffffff",position:"absolute",top:"100%",left:"0","margin-top":"8px",border:"black 1px solid","border-radius":"4px",padding:"4px",display:"grid","grid-template-columns":"repeat(7, 1fr)","flex-wrap":"wrap","text-align":"center"},on:{mousedown:e.preventHide}},e._l(e.symbols,(function(t,n){return a("div",{key:n,staticClass:"letter",on:{click:function(a){return e.insertSymbol(t)}}},[e._v(" \\("+e._s(t)+"\\) ")])})),0)])])]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.formula,expression:"formula"}],ref:"formulaTextarea",staticStyle:{width:"100%"},attrs:{rows:"3",autofocus:""},domProps:{value:e.formula},on:{click:e.updateFormulaCursorPos,keydown:e.updateFormulaCursorPos,input:function(t){t.target.composing||(e.formula=t.target.value)}}}),a("div",{staticStyle:{"font-weight":"bolder",margin:".8rem 0 .4rem"}},[e._v("Результат:")]),a("div",{ref:"formulaPreview",staticStyle:{margin:".5rem 0",height:"40px"}})]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(t){e.showModal=!1}}},[e._v("Отмена")]),e.isInEditMode?a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.saveFormula}},[e._v("Сохранить ")]):a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.addFormula}},[e._v("Добавить ")])])])])])])])},x=[],S={name:"formulaModal",components:{mathFormula:w},props:{isInEditMode:{type:Boolean,default:!1}},data:function(){return{showModal:!1,updateFormulaTimeout:null,formula:"",data:null,showLetters:!1,showOperators:!1,showSymbols:!1,preventHideFlag:!1,changeOpacity:!1,preventFormulaWatcher:!1,letters:["\\alpha","\\beta","\\gamma","\\delta","\\epsilon","\\zeta","\\eta","\\theta","\\iota","\\kappa","\\lambda","\\mu","\\nu","\\omicron","\\pi","\\rho","\\sigma","\\tau","\\upsilon","\\phi","\\chi","\\psi","\\omega","\\Gamma","\\Delta","\\Theta","\\Lambda","\\Xi","\\Pi","\\Upsilon","\\Phi","\\Psi","\\Omega","\\Sigma","\\mathbb{N}","\\mathbb{Z}","\\mathbb{Q}","\\mathbb{R}","\\mathbb{C}"],operators:["\\sqrt{ab}","\\sqrt[n]{ab}","\\log_{a}{b}","\\lg{ab}","a^{b}","a_{b} c_a^b","c_a^b","\\widetilde{ab}","\\widehat{ab}","\\overrightarrow{ab}","\\overline{ab}","\\frac{ab}{cd}","\\frac{\\partial a}{\\partial b}","\\frac{\\text{d}x}{\\text{d}y}","\\lim_{a \\rightarrow b}","\\int_{a}^{b}","\\prod_a^b","\\bigcap_a^b","\\bigcup_a^b","\\sum_a^b","\\left(\\begin{array}{c}a\\\\ b\\end{array}\\right)","\\begin{bmatrix}a & b \\\\c & d \\end{bmatrix}","\\begin{cases}a & x = 0\\\\b & x > 0\\end{cases}"],symbols:["\\times","\\div","\\pm","\\mp","\\cdot","\\star","\\neq","\\leq","\\geq","\\sim","\\approx","\\cong","\\equiv","\\ll","\\gg","\\in","\\subset","\\subseteq","\\ni","\\models","\\vdash","\\perp","\\mid","\\parallel","\\hat{a}","\\check{a}","\\acute{a}","\\tilde{a}","\\bar{a}","\\vec{a}","\\dot{a}","\\ddot{a}","\\leftarrow","\\Leftarrow","\\rightarrow","\\Rightarrow","\\leftrightarrow","\\Leftrightarrow","\\exists","\\forall","\\triangle","\\triangledown"]}},watch:{formula:function(){var e=this;this.updateFormulaTimeout&&clearTimeout(this.updateFormulaTimeout),this.preventFormulaWatcher?this.preventFormulaWatcher=!1:this.updateFormulaTimeout=setTimeout((function(){window.katex.render("".concat(e.formula),e.$refs.formulaPreview,{throwOnError:!1,output:"html"}),e.changeOpacity&&(e.$refs.formulaPreview.style.opacity=1,e.changeOpacity=!1)}),1500)},showModal:function(){this.showModal&&setTimeout((function(){}),1e3)}},methods:{toggle:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.data=t,this.formula="",this.$refs.formulaPreview.innerHTML="",this.isInEditMode&&(this.preventFormulaWatcher=!0,this.formula=t.latex,window.katex.render("".concat(this.formula),this.$refs.formulaPreview,{throwOnError:!1,output:"html"})),this.showModal=!0,this.$nextTick((function(){e.$refs.formulaTextarea.focus()}))},test:function(){console.log("123")},preventHide:function(){this.preventHideFlag=!0},hideSelf:function(){this.preventHideFlag?this.preventHideFlag=!this.preventHideFlag:(this.showLetters=!1,this.showOperators=!1,this.showSymbols=!1)},updateData:function(){this.data=this.$refs.textarea.innerHTML},updateFormulaCursorPos:function(e){var t=this;setTimeout((function(){t.formulaCursorPos=e.target.selectionStart}),100)},insertToFormula:function(e){void 0!==this.formulaCursorPos?this.formula=this.formula.slice(0,this.formulaCursorPos)+" ".concat(e," ")+this.formula.slice(this.formulaCursorPos):this.formula+=" ".concat(e," ")},insertLetter:function(e){this.showLetters=!1,this.insertToFormula(e)},insertOperator:function(e){this.showOperators=!1,this.insertToFormula(e)},insertSymbol:function(e){this.showSymbols=!1,this.insertToFormula(e)},addFormula:function(){this.showModal=!1,this.$emit("insert-latex",this.formula)},editFormula:function(){console.log("editFormula")},saveFormula:function(){this.showModal=!1,this.data.latex=this.formula,this.$emit("insert-latex",this.data)}}},C=S,F=(a("36b2"),Object(l["a"])(C,y,x,!1,null,null,null)),_=F.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showModal,expression:"showModal"}],staticClass:"modal-mask"},[a("div",{staticClass:"modal-wrapper"},[a("div",{staticClass:"modal-dialog modal-lg",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title"},[e._v("Вставить картинку")]),a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"},on:{click:function(t){e.showModal=!1}}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])]),a("div",{staticClass:"modal-body"},[a("input",{ref:"fileInput",attrs:{type:"file",accept:"image/*",multiple:""},on:{change:e.onUpload}}),e.isMultiple?a("div",{staticStyle:{"margin-top":"24px",display:"flex","justify-content":"space-evenly","align-items":"center"}},[a("button",{on:{click:function(t){e.activeFileIndex>0&&e.activeFileIndex--}}},[e._v("prev.")]),e._v(" Картинка "+e._s(e.activeFileIndex+1)+" из "+e._s(e.files.length)+" "),a("button",{on:{click:function(t){e.activeFileIndex<e.files.length-1&&e.activeFileIndex++}}},[e._v("next.")])]):e._e(),e.files.length>0?a("div",[a("div",{staticStyle:{"font-weight":"bolder","margin-top":".8rem"}},[e._v("Превью:")]),a("div",{ref:"imageDiv",staticClass:"image"},[a("img",{attrs:{src:e.activeFile.image.src,height:e.activeFile.image.height,width:e.activeFile.image.width}})]),a("div",{staticClass:"d-flex justify-content-center align-items-center"},[a("label",{staticStyle:{"margin-right":".4rem","margin-bottom":"0"},attrs:{for:"scale"}},[e._v("Масштаб:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.activeFile.scale,expression:"activeFile.scale"}],attrs:{type:"text",id:"scale",list:"scales"},domProps:{value:e.activeFile.scale},on:{input:function(t){t.target.composing||e.$set(e.activeFile,"scale",t.target.value)}}}),a("datalist",{attrs:{id:"scales"}},e._l(e.scales,(function(e){return a("option",{key:e,domProps:{value:e}})})),0)])]):e._e()]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:function(t){e.showModal=!1}}},[e._v("Отмена")]),a("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:0===e.files.length},on:{click:e.addImage}},[e._v("Добавить ")])])])])])])])},$=[],M=(a("ddb0"),a("2b3d"),{name:"imageModal",props:{uploadUrl:{type:String,default:null}},data:function(){return{showModal:!1,scales:[25,50,75,100],activeFileIndex:0,files:[]}},computed:{isMultiple:function(){return this.files.length>1},activeFile:function(){return this.files[this.activeFileIndex]}},watch:{"activeFile.scale":function(e){e>100?this.activeFile.scale=100:e<0?this.activeFile.scale=1:void 0!==this.activeFile&&(this.activeFile.image.height=this.activeFile.baseHeight*this.activeFile.scale/100,this.activeFile.image.width=this.activeFile.baseWidth*this.activeFile.scale/100)}},methods:{toggle:function(){this.files=[],this.$refs.fileInput.value=null,this.showModal=!0},onUpload:function(e){var t=this,a=!1;if(Array.from(e.target.files).forEach((function(e){e.size>307200&&(a=!0)})),a)return alert("Максимальный размер одного файла - 300 Кбайт"),void(this.$refs.fileInput.value=null);this.files=[];var n=e.target.files.length;Array.from(e.target.files).forEach((function(e){var a={file:e,image:null,url:URL.createObjectURL(e),scale:100};function i(e){return new Promise((function(t,a){var n=new Image;n.onload=function(){t(this)},n.onerror=a,n.src=e}))}i(a.url).then((function(e){a.image=e,a.baseHeight=e.height,a.baseWidth=e.width,t.files.push(a),n--}))}));var i=setInterval((function(){if(0===n){var e=t.$refs.imageDiv.clientHeight-24,a=t.$refs.imageDiv.clientWidth-16;t.files.forEach((function(t){var n=1;n=e/a<t.baseHeight/t.baseWidth?e/t.baseHeight:a/t.baseWidth,t.image.width=t.baseWidth*n,t.image.height=t.baseHeight*n,t.baseWidth=t.image.width,t.baseHeight=t.image.height})),t.files.length>0?t.activeFileIndex=0:t.activeFileIndex=null,t.$forceUpdate(),clearInterval(i)}}),200)},addImage:function(){var e=this,t=[];null===this.uploadUrl?alert("Не указан URL для загрузки картинок"):this.files.forEach((function(a){var n=new FormData;n.append("width",a.image.width),n.append("height",a.image.height),n.append("image",a.file),fetch(e.uploadUrl,{method:"POST",body:n}).then((function(e){return e.json()})).then((function(e){t.push(e.image_path)}))}));var a=setInterval((function(){t.length===e.files.length&&(e.showModal=!1,e.$emit("insert-images",t),clearInterval(a))}),200)}}}),z=M,T=(a("f949"),Object(l["a"])(z,k,$,!1,null,null,null)),L=T.exports,E={name:"wysiwygMath",components:{mathFormula:w,formulaModal:_,imageModal:L},props:{id:String,noHeight:{type:Boolean,default:!1},placeholder:String,rows:{type:Number,default:5},enableImageUpload:{type:Boolean,default:!1}},data:function(){return{showPopup:!1,hideTimeout:null,preventHideFlag:!1,data:"",selection:null,range:null,align:"left",fontStyles:[{tag:"b",icon:"fas fa-bold",style:"bold",selected:!1},{tag:"i",icon:"fas fa-italic",style:"italic",selected:!1},{tag:"u",icon:"fas fa-underline",style:"underline",selected:!1},{tag:"strike",icon:"fas fa-strikethrough",style:"strikethrough",selected:!1}],lists:[{tag:"ul",icon:"fas fa-list-ul",style:"insertUnorderedList",selected:!1},{tag:"ol",icon:"fas fa-list-ol",style:"insertOrderedList",selected:!1}],textStyles:[{tag:"left",icon:"fas fa-align-left",style:"left",selected:!1},{tag:"center",icon:"fas fa-align-center",style:"center",selected:!1},{tag:"right",icon:"fas fa-align-right",style:"right",selected:!1},{tag:"justify",icon:"fas fa-align-justify",style:"justify",selected:!1}],fontSizes:[{name:"x-small",value:"1"},{name:"small",value:"2"},{name:"medium",value:"3"},{name:"large",value:"4"},{name:"x-large",value:"5"},{name:"xx-large",value:"6"},{name:"xxx-large",value:"7"}],selectedFontSize:12,newFontSizes:[8,9,10,11,12,14,18,24,30,36,48,60,72,96],updateFormulaTimeout:null}},computed:{cursorPos:function(){try{return this.range.startOffset}catch(e){return-1}}},watch:{},methods:{preventHide:function(){this.preventHideFlag=!0},setStyle:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(document.execCommand(e,a,n),this.$refs.textarea.focus(),i){var s=this.fontStyles.find((function(t){return t.style===e}));s&&(s.selected=!s.selected)}else setTimeout((function(){t.analyze()}),100)},resetChildStyle:function(e,t){var a=this;e instanceof HTMLElement&&Array.from(e.children).forEach((function(e){e.style[t]=null,a.resetChildStyle(e,t)}))},isEditor:function(e){return void 0!==e.classList&&Array.from(e.classList).includes("editor")},textAlign:function(e){var t=this,a=this.selection.getRangeAt(0).commonAncestorContainer;if(this.resetChildStyle(a,"textAlign"),this.isEditor(a)){var n=this.range.extractContents(),i=document.createElement("p");i.style.textAlign=e,i.appendChild(n),this.range.insertNode(i)}else{while("p"!==a.nodeName.toLowerCase())a=a.parentNode;a.style.textAlign=e}this.$refs.textarea.focus(),setTimeout((function(){t.analyze()}),100)},hideSelf:function(){this.preventHideFlag?this.preventHideFlag=!this.preventHideFlag:this.showPopup=!1},createFormula:function(){this.$refs.formulaAddModal.toggle()},insertImage:function(){this.$refs.imageAddModal.toggle()},onDivInput:function(e){this.$emit("input",e.target.innerHTML),this.data=e.target.innerHTML;var t=/^(\n)*$/;t.test(e.target.innerText)&&(this.$refs.textarea.innerHTML='<p><span class="wrapper" style="font-size: '.concat(this.selectedFontSize,'pt;">&#65279;</span></p>'))},onDataRawInput:function(){this.$refs.textarea.innerHTML=this.data},removeFontSizeRecursive:function(e){var t=this;void 0!==e.style&&e.removeAttribute("style"),Array.from(e.children).forEach((function(e){t.removeFontSizeRecursive(e)}))},removeEmptyWrappers:function(){this.$refs.textarea.querySelectorAll(".wrapper").forEach((function(e){""===e.textContent&&e.remove()}))},removeWrappers:function(e,t,a){var n=this;console.log("deepness = ".concat(a)),e.querySelectorAll(".wrapper").forEach((function(e){var i=document.createElement("span");i.innerHTML=e.innerHTML,e.parentNode.insertBefore(i,e),n.removeWrappers(e,!0,a+1),t&&e.parentNode.removeChild(e)}))},findWrapper:function(e,t){return console.log(e),console.log(t),"SPAN"===e.parentNode.tagName?e.parentNode.textContent!==t?this.findWrapper(e.parentNode,t):e:null},changeFontSize:function(){var e=this,t=this.selectedFontSize;if("\ufeff"===this.$refs.textarea.textContent)this.$refs.textarea.innerHTML='<p><span class="wrapper" style="font-size: '.concat(this.selectedFontSize,'pt;">&#65279;</span></p>');else{var a,n=this.range.extractContents(),i=!1,s=document.createElement("span"),o=n.cloneNode(!0);s.appendChild(o),void 0!==this.range.commonAncestorContainer.classList&&this.range.commonAncestorContainer.classList.contains("wrapper")&&this.range.commonAncestorContainer.textContent===s.textContent?a=this.range.commonAncestorContainer:(i=!0,a=document.createElement("span"),a.classList.add("wrapper")),a.style.fontSize=this.selectedFontSize.toString()+"pt",a.innerHTML="&#65279;",a.appendChild(n),Array.from(a.children).forEach((function(t){return e.removeFontSizeRecursive(t)})),s.remove(),this.removeEmptyWrappers(),i?this.range.insertNode(a):(this.range.selectNodeContents(a),this.selection.removeAllRanges(),this.selection.addRange(this.range))}this.range.collapse(!1),this.updateData(),this.$nextTick((function(){e.$refs.textarea.focus(),e.selectedFontSize=t}))},getRenderedFormula:function(e){var t=n["a"].extend(w),a=new t({propsData:{latex:e}});return a.$mount(),a},insertLaTeX:function(e){var t=this.getRenderedFormula(e),a=document.createTextNode("\ufeff");this.range.insertNode(a),this.range.insertNode(t.$el),this.range.collapse(!1),this.selection.removeAllRanges(),this.selection.addRange(this.range),this.$refs.textarea.focus(),console.log(this.range),console.log(this.selection)},modifyLaTeX:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.getRenderedFormula(e.latex);e.element.parentNode.insertBefore(a.$el,e.element),e.element.parentNode.removeChild(e.element),t||(this.selection.removeAllRanges(),this.selection.addRange(this.range),this.selection.collapseToEnd(),this.$refs.textarea.focus())},insertImages:function(e){var t=this;e.forEach((function(e){var a=new Image;a.src=e;var n=document.createElement("p");n.appendChild(a),t.range.insertNode(n)}))},rerenderFormulas:function(){var e=this;this.$refs.textarea.querySelectorAll(".wysiwyg-math-formula").forEach((function(t){e.modifyLaTeX({element:t,latex:t.dataset.latex},!0)}))},updateData:function(){this.data=this.$refs.textarea.innerHTML},updateCursorPos:function(e){var t=window.getSelection();this.$refs.textarea.contains(t.anchorNode)&&(this.selection=t,this.range=this.selection.getRangeAt(0),null!==e&&"type"in e&&"click"===e.type?setTimeout(this.analyze,100):this.analyze())},analyze:function(){var e,t=this.selection,a=[],n={};if(t.rangeCount){e=t.getRangeAt(0).commonAncestorContainer;while(1){if(null==e)break;var i=e.nodeName.toLowerCase();if(e===this.$refs.textarea)break;function s(e,t){try{return""!==e[t]?e[t]:null}catch(a){return null}}"textAlign"in n&&null!==n.textAlign||(n.textAlign=s(e.style,"textAlign")),"fontSize"in n&&null!==n.fontSize||(n.fontSize=s(e.style,"fontSize")),"fontWeight"in n&&null!==n.fontWeight||(n.fontWeight=s(e.style,"fontWeight")),a.push(i),e=e.parentNode}}if(![void 0,null].includes(n.fontSize)){var o=parseInt(n.fontSize.slice(0,-2)),r=n.fontSize.slice(-2);"px"===r&&(o*=3/4),this.selectedFontSize=o}this.lists.forEach((function(e){return e.selected=a.includes(e.tag)})),this.fontStyles.forEach((function(e){return e.selected=a.includes(e.tag)})),"bolder"===n.fontWeight&&(this.fontStyles[0].selected=!0);var l=!1;this.textStyles.forEach((function(e){e.selected=n.textAlign===e.tag,e.selected&&(l=!0)})),l||(this.textStyles[0].selected=!0)},increaseFont:function(){var e=window.getSelection().getRangeAt(0).commonAncestorContainer.parentElement;if(e!==this.$refs.textarea){if(""!==e.style.fontSize){var t=this.fontSizes.map((function(e){return e.name})).indexOf(e.style.fontSize);t<this.fontSizes.length-1&&(document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,this.fontSizes[t+1].value),document.execCommand("styleWithCSS",!1,!1))}}else document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,this.fontSizes[3].value),document.execCommand("styleWithCSS",!1,!1)},decreaseFont:function(){var e=window.getSelection().getRangeAt(0).commonAncestorContainer.parentElement;if(e!==this.$refs.textarea){if(""!==e.style.fontSize){var t=this.fontSizes.map((function(e){return e.name})).indexOf(e.style.fontSize);t>0&&(document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,this.fontSizes[t-1].value),document.execCommand("styleWithCSS",!1,!1))}}else document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,this.fontSizes[1].value),document.execCommand("styleWithCSS",!1,!1)}},beforeCreate:function(){},beforeMount:function(){},mounted:function(){var e=this;window.bus=new n["a"]({}),window.bus.$on("formula-click",(function(t){e.$refs.formulaEditModal.toggle(t)})),document.execCommand("defaultParagraphSeparator",!1,"p"),this.$refs.textarea.innerHTML='<p><span class="wrapper" style="font-size: 12pt;">&#65279;</span></p>',document.addEventListener("mouseup",(function(t){e.updateCursorPos(t)}))},updated:function(){}},A=E,H=(a("1fde"),Object(l["a"])(A,f,h,!1,null,null,null)),O=H.exports;n["a"].use(d["a"]);var I=[{path:"/katex",name:"wysiwygKaTeX",component:O,props:{enableImageUpload:!0}}],P=new d["a"]({routes:I}),N=P;n["a"].config.productionTip=!1,new n["a"]({router:N,render:function(e){return e(u)}}).$mount("#app")},"85ec":function(e,t,a){},dd43:function(e,t,a){},f0f1:function(e,t,a){},f949:function(e,t,a){"use strict";var n=a("5677"),i=a.n(n);i.a},fc20:function(e,t,a){"use strict";var n=a("dd43"),i=a.n(n);i.a}});
//# sourceMappingURL=app.0f2fad7a.js.map